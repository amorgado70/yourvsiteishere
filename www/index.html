<!Doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <!-- base href="/demo/" / -->
    <title>Mobile Angular UI Demo</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <meta name="apple-mobile-web-app-status-bar-style" content="yes" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="css/mobile-angular-ui-hover.min.css" />
    <link rel="stylesheet" href="css/mobile-angular-ui-base.min.css" />
    <link rel="stylesheet" href="css/mobile-angular-ui-desktop.min.css" />    
    <!-- GoogleMap CSS -->
    <link rel="stylesheet" type="text/css" href="css/ipmrvpark.css" />
    <!-- Cordova -->
    <script src='cordova.js'></script>
    <!-- Required to use autocomplete -->
    <script src='js/jquery-2.2.1.js'></script>
    <script src='js/jquery-ui-1.11.4.js'></script>
    <!-- Google maps for jQuery -->
    <script type="text/javascript" src="js/gmapapijs?sensor=true&key=AIzaSyCN7Z5pyiivskygZ6jCxlzkDv5WYmrK23c"></script>
    <script type="text/javascript" src="js/gmaps.js"></script>
</head>

<script type="text/javascript">
    // Global variables
        var latitude = 0;
        var longitude = 0;
        var label = ' ';    
    $(document).ready(function () {
        // ***** Site Search
        $('#siteName').click(function () {
            $('#siteName').val('');
        });
        $('#siteName').autocomplete({
            source: function (request, response) {
                var postpath = 'http://www.alvm.com.br/ipmrvpark/RVSiteCoordView/GetSites';
                $.ajax({
                    url: postpath,
                    type: 'POST',
                    dataType: 'json',
                    // query will be the param used by the action method
                    data: { query: request.term },
                    success: response
                });
            },
            minLength: 1, // require at least one character from the user
            select: function (event, ui) {
                $('#id').val(ui.item.ID); // name of form input field: CustomerID, ProductID
                latitude = parseFloat(ui.item.Longitude);
                longitude = parseFloat(ui.item.Latitude);
                label = ui.item.label;
                $('#latitude').val(latitude);
                $('#longitude').val(longitude);
                updateGMaps();
            }
        });
        
// ***** Begin of Google Maps
        
        function updateGMaps(){
            
        
 var map = new GMaps({
    el: '#map',
    lat: latitude,
    lng: longitude,
    zoom: 15,
    zoomControl : true,
    zoomControlOpt: {
        style : 'SMALL',
        position: 'TOP_LEFT'
    },
     mapTypeId: google.maps.MapTypeId.HYBRID,
    panControl : false,
  });

            map.addMarker({
      lat: latitude,
      lng: longitude,
      title: label,
      //icon: 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + label + '|FFFF00|000000'
      icon: 'images/m2.png'
    });       
            
        }
        

        
// ***** End of Google Maps
        
// ***** Begin of CORS        
        
// Create the XHR object.
function createCORSRequest(method, url) {
  var xhr = new XMLHttpRequest();
  if ("withCredentials" in xhr) {
    // XHR for Chrome/Firefox/Opera/Safari.
    xhr.open(method, url, true);
  } else if (typeof XDomainRequest != "undefined") {
    // XDomainRequest for IE.
    xhr = new XDomainRequest();
    xhr.open(method, url);
  } else {
    // CORS not supported.
    xhr = null;
  }
  return xhr;
}

// Helper method to parse the title tag from the response.
function getTitle(text) {
  return text.match('<title>(.*)?</title>')[1];
}

// Make the actual CORS request.
function makeCorsRequest() {
    alert('Hello from CORS');
    
  // All HTML5 Rocks properties support CORS.
  var url = 'http://updates.html5rocks.com';

  var xhr = createCORSRequest('GET', url);
  if (!xhr) {
    alert('CORS not supported');
    return;
  }

  // Response handlers.
  xhr.onload = function() {
    var text = xhr.responseText;
    var title = getTitle(text);
    alert('Response from CORS request to ' + url + ': ' + title);
  };

  xhr.onerror = function() {
    alert('Woops, there was an error making the request.');
  };

  xhr.send();
}        

// ***** End of CORS        
        
    });
</script>    


<body>
    <div class="container">
    <!-- RV Site Selection -->
    <div class="row form-top-margin">
        <div class="col-sm-2 col-xs-12">
            <label>RV Site</label>
        </div>
        <div class="col-sm-4 col-xs-12" data-toggle="tooltip" title="Search and select with autocomplete">
            <input type="text" class="form-control" id="siteName" placeholder="Type letter or number then select from the list"/>
            <input class="text-box single-line" id="id" name="id" type="hidden" disabled/>
        </div>
    </div>
    <div class="row form-top-margin">
        <div class="col-sm-2 col-xs-12">
            <label>Latitude</label>
        </div>
        <div class="col-sm-4 col-xs-12">
            <input class="form-control" id="latitude" name="latitude" type="text" disabled />
        </div>
    </div>
    <div class="row form-top-margin">
        <div class="col-sm-2 col-xs-12">
            <label>Longitude</label>
        </div>
        <div class="col-sm-4 col-xs-12">
            <input class="form-control" id="longitude" name="longitude" type="text" disabled />
        </div>
    </div>                 
    <div>
    <div id="map"></div>
            </div>
</div>        
</body>

</html>
